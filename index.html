<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Crystal Crysis: Found’s World - Mini Adventure</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --bg:#000; --fg:#f4e7ff; --muted:#d9c7ff; --fx:#b5179e; --fx2:#8a2be2;
    --soft:#5c0a5b66; --border:#5c0a5b;
    --good:#22c55e; --warn:#f59e0b; --bad:#ef4444;
  }
  @font-face { font-family:"ULTRAKILL"; src:url("./fonts/ULTRAKILL.ttf") format("truetype"); font-display: swap; }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:#000;color:var(--fg);font:15px/1.55 ULTRAKILL,system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif;min-height:100vh}
  .bg{position:fixed;inset:0;z-index:-2;background:
      radial-gradient(circle at 30% -10%, #2d0036 0%, #070007 55%, #000 100%),
      radial-gradient(ellipse at 80% 80%, rgba(181,23,158,.12), transparent 40%);}
  .crt::after{content:"";position:fixed;inset:0;z-index:-1;pointer-events:none;
      background:repeating-linear-gradient(0deg,rgba(255,255,255,.02) 0 2px,rgba(0,0,0,0)2px 4px);
      mix-blend-mode:overlay;opacity:.35;animation:flicker 6s steps(10) infinite}
  @keyframes flicker{0%,100%{opacity:.38}50%{opacity:.26}}

  .wrap{max-width:980px;margin:0 auto;padding:24px}
  header{margin-top:8vh;text-align:center}
  h1{font-size:clamp(26px,5vw,56px);letter-spacing:.06em;text-shadow:0 0 18px rgba(255,0,255,.18);margin:0}
  .sub{color:#ead6ffcc;margin-top:8px}
  .panel{border:1px solid var(--border);background:rgba(0,0,0,.6);border-radius:16px;padding:16px;box-shadow:0 0 22px rgba(181,23,158,.18)}
  .traffic{display:flex;gap:6px;align-items:center}
  .dot{width:12px;height:12px;border-radius:50%;opacity:.8}
  .r{background:#ef4444cc}.y{background:#f59e0bcc}.g{background:#22c55ecc}
  .term{letter-spacing:.18em;text-transform:uppercase;font-size:11px;color:#e6c6ff99}

  .scene{margin-top:16px}
  .title{font-size:18px;color:#f6c1ff;margin-bottom:6px;letter-spacing:.03em}
  .text{color:#f4e7ff;opacity:.95}
  .choices{display:grid;gap:10px;margin-top:14px}
  .btn{border:1px solid var(--border);color:#f7eaff;background:transparent;border-radius:10px;padding:10px 12px;text-align:left;cursor:pointer}
  .btn:hover{background:#b5179e33;border-color:#d96ae8}
  .inline{display:inline-flex;gap:8px;align-items:center}
  .pill{font-size:10px;border:1px dashed var(--soft);padding:3px 7px;border-radius:999px;color:#e6c6ffcc}

  .hud{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .card{border:1px solid var(--soft);background:rgba(0,0,0,.45);border-radius:12px;padding:10px}
  .k{font-size:10px;letter-spacing:.2em;text-transform:uppercase;color:#e6c6ffcc}
  .v{margin-top:3px;font-weight:700}
  .log{margin-top:16px;max-height:160px;overflow:auto;border:1px solid var(--soft);background:rgba(0,0,0,.35);border-radius:12px;padding:10px;font-size:13px}
  .log b{color:#fff}

  .rollbox{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.6);backdrop-filter:blur(2px);z-index:50}
  .roll{width:min(520px,92%);border:1px solid var(--border);background:#0a000f;border-radius:16px;padding:16px;box-shadow:0 0 30px #b5179e55}
  .big{font-size:42px;margin:0 4px}
  .center{text-align:center}
  .good{color:var(--good)} .bad{color:var(--bad)}
  .small{color:var(--muted);font-size:12px}
  .row{display:flex;justify-content:space-between;gap:8px;align-items:center}

  .ending{margin-top:18px;border:1px solid var(--border);background:rgba(0,0,0,.6);border-radius:16px;padding:16px}
  .ending h2{margin:0 0 6px 0;font-size:22px;color:#f6c1ff}
  .cta{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .primary{border:1px solid #9333ea;background:rgba(147,51,234,.15)}
  .primary:hover{background:rgba(147,51,234,.25)}

  footer{color:#a98eea;text-align:center;font-size:12px;margin:26px 0}
</style>
</head>
<body class="crt">
  <div class="bg"></div>
  <div class="wrap">
    <header>
      <h1>Crystal Crysis - Found’s Intro Adventure</h1>
      <div class="sub">A quick “choose your path” set during the Festival of Valor in Sharn.</div>
    </header>

    <div class="panel">
      <div class="row" style="display:flex;gap:10px;align-items:center;justify-content:space-between;margin-bottom:8px">
        <div class="traffic"><span class="dot r"></span><span class="dot y"></span><span class="dot g"></span></div>
        <div class="term">Found/ops/public - r/o</div>
        <button id="mute" class="btn" style="padding:6px 10px">sound off</button>
      </div>

      <div id="scene" class="scene"></div>

      <div class="hud">
        <div class="card">
          <div class="k">Advantage</div>
          <div class="v">ON (2d20, keep highest)</div>
        </div>
        <div class="card">
          <div class="k">Basic Modifiers</div>
          <div class="v">Force +2 • Finesse +2 • Insight +2 • Will +2</div>
        </div>
        <div class="card">
          <div class="k">Goal</div>
          <div class="v">Survive the outbreak & keep the peace under Caelen Bind</div>
        </div>
      </div>

      <div id="log" class="log"></div>
    </div>

    <footer>© <span id="yr"></span> Found’s Facility - Amethyst Division • Keep civilians breathing.</footer>
  </div>

  <!-- Dice roll modal -->
  <div id="rollbox" class="rollbox">
    <div class="roll">
      <div class="row">
        <div class="k">Check</div>
        <div id="rollStat" class="pill">Finesse</div>
      </div>
      <div class="center" style="margin:12px 0">
        <span id="d1" class="big">d20</span> &nbsp;◆&nbsp;
        <span id="d2" class="big">d20</span>
      </div>
      <div class="center">
        Highest + mod: <b id="total" class="">-</b>
        <div id="outcome" class="small"></div>
      </div>
      <div class="center" style="margin-top:12px">
        <button id="rollClose" class="btn">continue</button>
      </div>
    </div>
  </div>

<script>
/*** CONFIG ***/
const DISCORD_LINK = "https://discord.gg/your-invite"; // ← change this

// Basic +2 mods, always roll with advantage
const MODS = { force: 2, finesse: 2, insight: 2, will: 2 };

// Scenes/structure.
// - if a choice has "check", it branches by success/fail to scene ids.
// - otherwise "to" goes directly.
// Endings are scenes with type: 'ending'.
const SCENES = {
  start: {
    title: "Festival of Valor - Valor Plaza, Upper Sharn",
    text: `The air tastes like rain and rosewater. Caelen Bind sigils hum underfoot as House Glasswrights unveil crystal-infused warforged.
A cracking note splits the sky. Crystal blooms across a tower like frost becoming knives. People scream. You have seconds to act.`,
    choices: [
      { label: "Hold the line, get civilians behind the Bind (Finesse check DC 11)", check: { stat: "finesse", dc: 11, success: "civ_ok", fail: "civ_scatter" } },
      { label: "Rush the shard-heart and try to cut the supply lines (Force check DC 12)", check: { stat: "force", dc: 12, success: "heart_cut", fail: "heart_bite" } },
      { label: "Listen, does the crystal whisper? (Insight check DC 10)", check: { stat: "insight", dc: 10, success: "nyxis_hint", fail: "mind_rattle" } }
    ]
  },

  civ_ok: {
    title: "Perimeter Set",
    text: "You shepherd families behind the sigil boundary. The Bind steadies hearts. Medics from House Vitae move in.",
    choices: [
      { label: "Coordinate with Flux to clear the lightning rail (Insight DC 11)", check: { stat: "insight", dc: 11, success: "rail_clear", fail: "rail_clog" } },
      { label: "Signal the Amethyst Knight for support", to: "knight_arrives" }
    ]
  },

  civ_scatter: {
    title: "Panic",
    text: "The crowd breaks. Someone trips at the sigil’s edge. You pull two clear, but fear spreads faster than glass.",
    choices: [
      { label: "Bark orders, steel your voice (Will DC 12)", check: { stat: "will", dc: 12, success: "civ_ok", fail: "mirror_lane" } },
      { label: "Abandon the perimeter, sprint to the shard-heart", to: "heart_bite" }
    ]
  },

  heart_cut: {
    title: "Supply Lines Severed",
    text: "Runes flare as you slice the crystal’s feed. The bloom dims, the ground stops singing.",
    choices: [
      { label: "Push deeper toward the core (Will DC 12)", check: { stat: "will", dc: 12, success: "core_glow", fail: "mind_rattle" } },
      { label: "Fall back, regroup the civilians", to: "civ_ok" }
    ]
  },

  heart_bite: {
    title: "Backlash",
    text: "Shards leap like teeth. Your hands ring. You drive them off, but the heart learns your rhythm.",
    choices: [
      { label: "Switch tactics: finesse the lines instead (Finesse DC 11)", check: { stat: "finesse", dc: 11, success: "heart_cut", fail: "mirror_lane" } },
      { label: "Call for help on open comms", to: "knight_arrives" }
    ]
  },

  nyxis_hint: {
    title: "A Voice in the Glass",
    text: "A symmetry in your name answers from inside the shard. “Step left. Do not look back.” The crowd opens.",
    choices: [
      { label: "Follow the instruction (Will DC 10)", check: { stat: "will", dc: 10, success: "mirror_skip", fail: "mirror_lane" } },
      { label: "Reject the voice, trust procedure", to: "civ_ok" }
    ]
  },

  mind_rattle: {
    title: "Echo",
    text: "The crystal hum matches your pulse. For a moment, you’re not sure whose fear you feel.",
    choices: [
      { label: "Breathe, re-center (Will DC 10)", check: { stat: "will", dc: 10, success: "civ_ok", fail: "mirror_lane" } },
      { label: "Muscle through it - hit the lines again", to: "heart_bite" }
    ]
  },

  rail_clear: {
    title: "Rail Junction Rerouted",
    text: "Flux conductors light the path, a train clears the plaza. Space to work. The bloom shrinks.",
    choices: [
      { label: "Coordinate with the Amethyst Knight to finish the heart", to: "knight_arrives" },
      { label: "Hold position and guard triage", to: "valor_ending" }
    ]
  },

  rail_clog: {
    title: "Gridlock",
    text: "A stalled cart pins the switch. You’re losing time.",
    choices: [
      { label: "Force the switch physically (Force DC 12)", check: { stat: "force", dc: 12, success: "rail_clear", fail: "mirror_lane" } },
      { label: "Abandon the rails, protect who you can", to: "civ_ok" }
    ]
  },

  mirror_lane: {
    title: "Mirror Lane",
    text: "Reflections step out wearing your face. They whisper bargains, each one a perfect, terrible you.",
    choices: [
      { label: "Avert your eyes, move by touch (Finesse DC 12)", check: { stat: "finesse", dc: 12, success: "mirror_skip", fail: "glass_family" } },
      { label: "Stare them down - who leads you? (Insight DC 12)", check: { stat: "insight", dc: 12, success: "nyxis_mark", fail: "glass_family" } }
    ]
  },

  mirror_skip: {
    title: "Eyes Down",
    text: "You pass blind and true. The lane collapses behind you like a shed skin of light.",
    choices: [
      { label: "Go for the core while the path is open", to: "core_glow" },
      { label: "Pull civilians through before it returns", to: "civ_ok" }
    ]
  },

  nyxis_mark: {
    title: "Symmetry Kept",
    text: "A single glyph settles under your skin. The mirrors nod, satisfied.",
    choices: [
      { label: "Use the mark to find weak seams (Insight DC 11)", check: { stat: "insight", dc: 11, success: "core_glow", fail: "heart_bite" } },
      { label: "Scrub it away, this is wrong", to: "mind_rattle" }
    ]
  },

  glass_family: {
    title: "Family of Glass",
    text: "Hoods of mirrored panes watch from a balcony. They approve when you falter.",
    choices: [
      { label: "Stand your ground (Will DC 12)", check: { stat: "will", dc: 12, success: "civ_ok", fail: "shard_ending" } },
      { label: "Break line and flee", to: "shard_ending" }
    ]
  },

  knight_arrives: {
    title: "Amethyst Knight",
    text: "A violet silhouette carves a corridor through the bloom. The crowd cheers. No names are exchanged.",
    choices: [
      { label: "Fight alongside the Knight (Force DC 11)", check: { stat: "force", dc: 11, success: "core_glow", fail: "heart_bite" } },
      { label: "Hold the Bind and cover triage", to: "valor_ending" }
    ]
  },

  core_glow: {
    title: "Core Exposed",
    text: "The shard-heart shows a crack like a smile. The hum drops to a purr.",
    choices: [
      { label: "Sever the heart, end the bloom (Will DC 12)", check: { stat: "will", dc: 12, success: "knight_ending", fail: "shard_ending" } },
      { label: "Spare it, listen to the whisper (Insight DC 12)", check: { stat: "insight", dc: 12, success: "prism_ending", fail: "shard_ending" } }
    ]
  },

  // ENDINGS
  valor_ending: {
    type: "ending",
    title: "ENDING: Valor Sigiled",
    blurb: "You kept the peace. Under Caelen Bind, you saved more lives than anyone counted. Not shining, steady.",
  },
  shard_ending: {
    type: "ending",
    title: "ENDING: Shard Whispered",
    blurb: "The crystal learned your rhythm. It will hum your name in other plazas. You survive, changed.",
  },
  prism_ending: {
    type: "ending",
    title: "ENDING: Prism Brokered",
    blurb: "You traded symmetry for time. The outbreak sleeps, not dies. Some debts are paid in reflections.",
  },
  knight_ending: {
    type: "ending",
    title: "ENDING: Knight’s Shadow",
    blurb: "Side by side with amethyst light, you made the cut that mattered. No names given. None needed.",
  },
};

/*** AUDIO (optional lightweight ambience) ***/
const audio = new Audio();
audio.src = ""; // (optional) put a loop mp3 path here if you want ambient
audio.loop = true;
audio.volume = 0.25;
let muted = true;

/*** ENGINE ***/
const elScene = document.getElementById("scene");
const elLog = document.getElementById("log");
const yr = document.getElementById("yr"); yr.textContent = new Date().getFullYear();
const muteBtn = document.getElementById("mute");

function logLine(t){ elLog.innerHTML += t + "<br/>"; elLog.scrollTop = elLog.scrollHeight; }

function renderScene(id){
  const s = SCENES[id];
  if(!s){ elScene.innerHTML = `<div class="title">ERROR</div><div class="text">Scene not found.</div>`; return; }

  // Ending
  if (s.type === "ending"){
    elScene.innerHTML = `
      <div class="ending">
        <h2>${s.title}</h2>
        <p>${s.blurb}</p>
        <div class="cta">
          <a class="btn primary" href="${DISCORD_LINK}" target="_blank" rel="noopener">Enjoyed playing this short webgame? Come play with us for real here!</a>
          <button class="btn" id="restart">Restart</button>
        </div>
      </div>
    `;
    document.getElementById("restart").onclick = () => { elLog.innerHTML = ""; renderScene("start"); };
    logLine(`<b>Reached:</b> ${s.title}`);
    return;
  }

  // Regular scene
  elScene.innerHTML = `
    <div class="title">${s.title}</div>
    <div class="text">${s.text.replace(/\n/g,"<br>")}</div>
    <div class="choices">
      ${s.choices.map((c,i) => {
        const hint = c.check ? `<span class="pill">${c.check.stat} DC ${c.check.dc}</span>` : "";
        return `<button class="btn" data-i="${i}"><span class="inline">${c.label} ${hint}</span></button>`;
      }).join("")}
    </div>
  `;

  // attach handlers
  elScene.querySelectorAll(".btn[data-i]").forEach(btn => {
    btn.addEventListener("click", () => {
      const idx = Number(btn.getAttribute("data-i"));
      const choice = s.choices[idx];
      if (choice.check){
        doCheck(choice.check, (ok) => {
          const next = ok ? choice.check.success : choice.check.fail;
          logLine(`<b>${s.title}:</b> ${choice.label} - ${ok ? '<span class="good">SUCCESS</span>' : '<span class="bad">FAIL</span>'}`);
          renderScene(next);
        });
      } else {
        logLine(`<b>${s.title}:</b> ${choice.label}`);
        renderScene(choice.to);
      }
    });
  });
}

// Advantage roll modal
const RB = document.getElementById("rollbox");
const d1El = document.getElementById("d1");
const d2El = document.getElementById("d2");
const totalEl = document.getElementById("total");
const outcomeEl = document.getElementById("outcome");
const statEl = document.getElementById("rollStat");
const closeBtn = document.getElementById("rollClose");

function rollD20(){ return Math.floor(Math.random()*20)+1; }
function doCheck({stat, dc}, cb){
  statEl.textContent = stat[0].toUpperCase() + stat.slice(1);
  RB.style.display = "grid";
  const a = rollD20(), b = rollD20();
  d1El.textContent = a; d2El.textContent = b;
  const hi = Math.max(a,b);
  const mod = MODS[stat] || 0;
  const total = hi + mod;
  totalEl.textContent = `${hi} + ${mod} = ${total}`;
  const ok = total >= dc;
  outcomeEl.innerHTML = ok ? `<span class="good">Success (DC ${dc})</span>` : `<span class="bad">Fail (DC ${dc})</span>`;
  closeBtn.onclick = () => { RB.style.display = "none"; cb(ok); };
}

// Sound button
muteBtn.onclick = () => {
  muted = !muted;
  muteBtn.textContent = muted ? "sound off" : "sound on";
  if (!audio.src) return; // no file set
  if (muted) { audio.pause(); }
  else {
    audio.play().catch(()=>{}); 
  }
};

// Start
renderScene("start");
logLine("&gt; SYSTEM: Outbreak detected near Valor Plaza. Keep the peace under Caelen Bind.");
</script>
</body>
</html>
